{"ast":null,"code":"// src/contexts/AuthContext.js\nimport React,{createContext,useState,useEffect,useCallback,useContext}from'react';import{checkAuth,logout as apiLogout}from'../services/auth';import api from'../services/api';import{initSocket,disconnectSocket}from'../services/socket';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);const[initialCheckDone,setInitialCheckDone]=useState(false);/**\n   * Solicita permissão para notificações do navegador\n   * @returns {Promise<boolean>} Retorna true se a permissão foi concedida\n   */const requestNotificationPermission=useCallback(async()=>{try{if(!('Notification'in window)){console.warn('Este navegador não suporta notificações desktop');return false;}if(Notification.permission==='granted'){return true;}if(Notification.permission!=='denied'){const permission=await Notification.requestPermission();if(permission==='granted'){console.log('Permissão para notificações concedida');return true;}}console.log('Permissão para notificações não concedida');return false;}catch(error){console.error('Erro ao solicitar permissão de notificações:',error);return false;}},[]);/**\n   * Verifica a autenticação do usuário\n   */const verifyAuth=useCallback(async()=>{const token=localStorage.getItem('token');if(!token){setLoading(false);setInitialCheckDone(true);return;}try{var _response$user,_response$user$settin;setLoading(true);const response=await checkAuth();setUser((response===null||response===void 0?void 0:response.user)||null);// Solicita permissão para notificações após verificar autenticação\nif((response===null||response===void 0?void 0:(_response$user=response.user)===null||_response$user===void 0?void 0:(_response$user$settin=_response$user.settings)===null||_response$user$settin===void 0?void 0:_response$user$settin.notificationsEnabled)!==false){await requestNotificationPermission();}}catch(error){console.error('Falha na verificação de autenticação:',error);localStorage.removeItem('token');setUser(null);}finally{setLoading(false);setInitialCheckDone(true);}},[requestNotificationPermission]);/**\n   * Realiza o login do usuário\n   */const login=useCallback(async credentials=>{try{var _response$user2,_response$user2$setti;setLoading(true);const response=await apiLogin(credentials);localStorage.setItem('token',response.token);setUser(response.user);// Solicita permissão para notificações se o usuário permitiu\nif(((_response$user2=response.user)===null||_response$user2===void 0?void 0:(_response$user2$setti=_response$user2.settings)===null||_response$user2$setti===void 0?void 0:_response$user2$setti.notificationsEnabled)!==false){await requestNotificationPermission();}return response;}catch(error){throw error;}finally{setLoading(false);}},[requestNotificationPermission]);/**\n   * Realiza o logout do usuário\n   */const logout=useCallback(async()=>{try{await apiLogout();localStorage.removeItem('token');setUser(null);disconnectSocket();// Desconecta o socket ao fazer logout\n}catch(error){console.error('Logout error:',error);}},[]);/**\n   * Atualiza os dados do usuário\n   */const updateUser=useCallback(async function(updates){let shouldRevalidate=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;try{// Atualização otimista\nsetUser(prev=>({...prev,...updates}));if(shouldRevalidate){await verifyAuth();}}catch(error){console.error('Falha ao atualizar usuário:',error);throw error;}},[verifyAuth]);/**\n   * Atualiza o avatar do usuário\n   */const updateAvatar=useCallback(async avatarFile=>{try{const formData=new FormData();formData.append('avatar',avatarFile);const{data}=await api.put('/users/profile',formData,{headers:{'Content-Type':'multipart/form-data'}});await updateUser(data);return data;}catch(error){console.error('Falha ao atualizar avatar:',error);throw error;}},[updateUser]);/**\n   * Atualiza as preferências de notificação\n   */const updateNotificationPreferences=useCallback(async enabled=>{try{await api.patch('/users/settings',{notificationsEnabled:enabled});await updateUser({settings:{...user.settings,notificationsEnabled:enabled}},false);if(enabled){await requestNotificationPermission();}return true;}catch(error){console.error('Falha ao atualizar preferências:',error);throw error;}},[user,updateUser,requestNotificationPermission]);// Verifica autenticação na inicialização\nuseEffect(()=>{verifyAuth();},[verifyAuth]);return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,loading,initialCheckDone,verifyAuth,login,logout,updateUser,updateAvatar,updateNotificationPreferences,requestNotificationPermission},children:children});};export const useAuth=()=>{const context=useContext(AuthContext);if(!context){throw new Error('useAuth deve ser usado dentro de um AuthProvider');}return context;};","map":{"version":3,"names":["React","createContext","useState","useEffect","useCallback","useContext","checkAuth","logout","apiLogout","api","initSocket","disconnectSocket","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","initialCheckDone","setInitialCheckDone","requestNotificationPermission","window","console","warn","Notification","permission","requestPermission","log","error","verifyAuth","token","localStorage","getItem","_response$user","_response$user$settin","response","settings","notificationsEnabled","removeItem","login","credentials","_response$user2","_response$user2$setti","apiLogin","setItem","updateUser","updates","shouldRevalidate","arguments","length","undefined","prev","updateAvatar","avatarFile","formData","FormData","append","data","put","headers","updateNotificationPreferences","enabled","patch","Provider","value","useAuth","context","Error"],"sources":["C:/Users/drrod/OneDrive/Área de Trabalho/jokerstar-apk/src/contexts/AuthContext.js"],"sourcesContent":["// src/contexts/AuthContext.js\nimport React, { createContext, useState, useEffect, useCallback, useContext } from 'react';\nimport { checkAuth, logout as apiLogout } from '../services/auth';\nimport api from '../services/api';\nimport { initSocket, disconnectSocket } from '../services/socket';\n\nconst AuthContext = createContext();\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [initialCheckDone, setInitialCheckDone] = useState(false);\n\n  /**\n   * Solicita permissão para notificações do navegador\n   * @returns {Promise<boolean>} Retorna true se a permissão foi concedida\n   */\n  const requestNotificationPermission = useCallback(async () => {\n    try {\n      if (!('Notification' in window)) {\n        console.warn('Este navegador não suporta notificações desktop');\n        return false;\n      }\n\n      if (Notification.permission === 'granted') {\n        return true;\n      }\n\n      if (Notification.permission !== 'denied') {\n        const permission = await Notification.requestPermission();\n        if (permission === 'granted') {\n          console.log('Permissão para notificações concedida');\n          return true;\n        }\n      }\n\n      console.log('Permissão para notificações não concedida');\n      return false;\n    } catch (error) {\n      console.error('Erro ao solicitar permissão de notificações:', error);\n      return false;\n    }\n  }, []);\n\n  /**\n   * Verifica a autenticação do usuário\n   */\n  const verifyAuth = useCallback(async () => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setLoading(false);\n      setInitialCheckDone(true);\n      return;\n    }\n  \n    try {\n      setLoading(true);\n      const response = await checkAuth();\n      setUser(response?.user || null);\n      \n      // Solicita permissão para notificações após verificar autenticação\n      if (response?.user?.settings?.notificationsEnabled !== false) {\n        await requestNotificationPermission();\n      }\n    } catch (error) {\n      console.error('Falha na verificação de autenticação:', error);\n      localStorage.removeItem('token');\n      setUser(null);\n    } finally {\n      setLoading(false);\n      setInitialCheckDone(true);\n    }\n  }, [requestNotificationPermission]);\n\n  /**\n   * Realiza o login do usuário\n   */\n  const login = useCallback(async (credentials) => {\n    try {\n      setLoading(true);\n      const response = await apiLogin(credentials);\n      localStorage.setItem('token', response.token);\n      setUser(response.user);\n      \n      // Solicita permissão para notificações se o usuário permitiu\n      if (response.user?.settings?.notificationsEnabled !== false) {\n        await requestNotificationPermission();\n      }\n      \n      return response;\n    } catch (error) {\n      throw error;\n    } finally {\n      setLoading(false);\n    }\n  }, [requestNotificationPermission]);\n\n  /**\n   * Realiza o logout do usuário\n   */\n  const logout = useCallback(async () => {\n    try {\n      await apiLogout();\n      localStorage.removeItem('token');\n      setUser(null);\n      disconnectSocket(); // Desconecta o socket ao fazer logout\n    } catch (error) {\n      console.error('Logout error:', error);\n    }\n  }, []);\n  /**\n   * Atualiza os dados do usuário\n   */\n  const updateUser = useCallback(async (updates, shouldRevalidate = true) => {\n    try {\n      // Atualização otimista\n      setUser(prev => ({ ...prev, ...updates }));\n      \n      if (shouldRevalidate) {\n        await verifyAuth();\n      }\n    } catch (error) {\n      console.error('Falha ao atualizar usuário:', error);\n      throw error;\n    }\n  }, [verifyAuth]);\n\n  /**\n   * Atualiza o avatar do usuário\n   */\n  const updateAvatar = useCallback(async (avatarFile) => {\n    try {\n      const formData = new FormData();\n      formData.append('avatar', avatarFile);\n      \n      const { data } = await api.put('/users/profile', formData, {\n        headers: {\n          'Content-Type': 'multipart/form-data'\n        }\n      });\n      \n      await updateUser(data);\n      return data;\n    } catch (error) {\n      console.error('Falha ao atualizar avatar:', error);\n      throw error;\n    }\n  }, [updateUser]);\n\n  /**\n   * Atualiza as preferências de notificação\n   */\n  const updateNotificationPreferences = useCallback(async (enabled) => {\n    try {\n      await api.patch('/users/settings', { notificationsEnabled: enabled });\n      await updateUser({ settings: { ...user.settings, notificationsEnabled: enabled } }, false);\n      \n      if (enabled) {\n        await requestNotificationPermission();\n      }\n      \n      return true;\n    } catch (error) {\n      console.error('Falha ao atualizar preferências:', error);\n      throw error;\n    }\n  }, [user, updateUser, requestNotificationPermission]);\n\n  // Verifica autenticação na inicialização\n  useEffect(() => {\n    verifyAuth();\n  }, [verifyAuth]);\n\n  return (\n    <AuthContext.Provider value={{\n      user,\n      loading,\n      initialCheckDone,\n      verifyAuth,\n      login,\n      logout,\n      updateUser,\n      updateAvatar,\n      updateNotificationPreferences,\n      requestNotificationPermission\n    }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n\nexport const useAuth = () => {\n  const context = useContext(AuthContext);\n  if (!context) {\n    throw new Error('useAuth deve ser usado dentro de um AuthProvider');\n  }\n  return context;\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}