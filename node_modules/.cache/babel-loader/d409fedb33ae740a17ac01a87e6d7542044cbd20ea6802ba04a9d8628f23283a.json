{"ast":null,"code":"// components/MentionInput.jsx\nimport React,{useState,useRef,useEffect}from'react';import styled from'styled-components';import api from'../services/api';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const InputContainer=styled.div`\n  position: relative;\n  width: 100%;\n`;const StyledTextarea=styled.textarea`\n  width: 100%;\n  min-height: 120px;\n  padding: 12px;\n  border-radius: var(--radius-sm);\n  border: 1px solid var(--border);\n  background: var(--input-bg);\n  color: var(--text);\n  resize: vertical;\n  transition: var(--transition);\n  font-family: inherit;\n  font-size: 14px;\n  line-height: 1.5;\n\n  &:focus {\n    outline: none;\n    border-color: var(--primary);\n    box-shadow: 0 0 0 2px rgba(255, 69, 0, 0.2);\n  }\n`;const SuggestionsList=styled.ul`\n  position: absolute;\n  bottom: 100%;\n  left: 0;\n  right: 0;\n  max-height: 200px;\n  overflow-y: auto;\n  background: var(--card-bg);\n  border: 1px solid var(--border);\n  border-radius: var(--radius-sm);\n  box-shadow: var(--shadow);\n  list-style: none;\n  padding: 0;\n  margin: 5px 0 0 0;\n  z-index: 100;\n`;const SuggestionItem=styled.li`\n  padding: 8px 12px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  transition: var(--transition);\n\n  &:hover {\n    background: rgba(255, 69, 0, 0.1);\n  }\n`;const Avatar=styled.img`\n  width: 24px;\n  height: 24px;\n  border-radius: 50%;\n  object-fit: cover;\n`;const MentionInput=_ref=>{let{value,onChange,placeholder}=_ref;const[showSuggestions,setShowSuggestions]=useState(false);const[suggestions,setSuggestions]=useState([]);const[mentionQuery,setMentionQuery]=useState('');const[mentionStartPos,setMentionStartPos]=useState(0);const textareaRef=useRef(null);const handleInputChange=e=>{const text=e.target.value;onChange(text);// Captura a posição atual do cursor\nconst cursorPos=e.target.selectionStart;// Encontra a posição do último @ antes do cursor\nconst lastAtPos=text.lastIndexOf('@',cursorPos-1);if(lastAtPos>=0&&cursorPos-lastAtPos>1){const query=text.substring(lastAtPos+1,cursorPos);setMentionQuery(query);setMentionStartPos(lastAtPos);if(query.length>=1){fetchMentions(query);setShowSuggestions(true);}else{setShowSuggestions(false);}}else{setShowSuggestions(false);}};const fetchMentions=async query=>{try{var _response$data;const response=await api.get('/users/search',{params:{q:query}});if((_response$data=response.data)!==null&&_response$data!==void 0&&_response$data.data){setSuggestions(response.data.data);}}catch(error){console.error('Error fetching mentions:',error);setSuggestions([]);}};const handleSelectMention=username=>{if(!textareaRef.current)return;const currentValue=value;const before=currentValue.substring(0,mentionStartPos);const after=currentValue.substring(mentionStartPos+mentionQuery.length+1);const newText=`${before}@${username} ${after}`;onChange(newText);setShowSuggestions(false);// Foca no textarea e posiciona o cursor\nsetTimeout(()=>{if(textareaRef.current){textareaRef.current.focus();const newCursorPos=mentionStartPos+username.length+2;textareaRef.current.setSelectionRange(newCursorPos,newCursorPos);}},0);};// Fechar sugestões ao clicar fora\nuseEffect(()=>{const handleClickOutside=e=>{if(textareaRef.current&&!textareaRef.current.contains(e.target)){setShowSuggestions(false);}};document.addEventListener('mousedown',handleClickOutside);return()=>document.removeEventListener('mousedown',handleClickOutside);},[]);return/*#__PURE__*/_jsxs(InputContainer,{children:[/*#__PURE__*/_jsx(StyledTextarea,{ref:textareaRef,value:value,onChange:handleInputChange,onSelect:handleInputChange// Importante para capturar seleção\n,placeholder:placeholder}),showSuggestions&&suggestions.length>0&&/*#__PURE__*/_jsx(SuggestionsList,{children:suggestions.map(user=>{var _user$profile;return/*#__PURE__*/_jsxs(SuggestionItem,{onClick:()=>handleSelectMention(user.username),children:[/*#__PURE__*/_jsx(Avatar,{src:((_user$profile=user.profile)===null||_user$profile===void 0?void 0:_user$profile.avatar)||'https://i.pravatar.cc/150?img=3',alt:user.username,crossOrigin:\"anonymous\",onError:e=>{e.target.src='https://i.pravatar.cc/150?img=3';}}),/*#__PURE__*/_jsxs(\"span\",{children:[\"@\",user.username]})]},user._id);})})]});};export default MentionInput;","map":{"version":3,"names":["React","useState","useRef","useEffect","styled","api","jsx","_jsx","jsxs","_jsxs","InputContainer","div","StyledTextarea","textarea","SuggestionsList","ul","SuggestionItem","li","Avatar","img","MentionInput","_ref","value","onChange","placeholder","showSuggestions","setShowSuggestions","suggestions","setSuggestions","mentionQuery","setMentionQuery","mentionStartPos","setMentionStartPos","textareaRef","handleInputChange","e","text","target","cursorPos","selectionStart","lastAtPos","lastIndexOf","query","substring","length","fetchMentions","_response$data","response","get","params","q","data","error","console","handleSelectMention","username","current","currentValue","before","after","newText","setTimeout","focus","newCursorPos","setSelectionRange","handleClickOutside","contains","document","addEventListener","removeEventListener","children","ref","onSelect","map","user","_user$profile","onClick","src","profile","avatar","alt","crossOrigin","onError","_id"],"sources":["C:/Users/drrod/OneDrive/Área de Trabalho/client2/src/components/MentionInput.jsx"],"sourcesContent":["// components/MentionInput.jsx\r\nimport React, { useState, useRef, useEffect } from 'react';\r\nimport styled from 'styled-components';\r\nimport api from '../services/api';\r\n\r\nconst InputContainer = styled.div`\r\n  position: relative;\r\n  width: 100%;\r\n`;\r\n\r\nconst StyledTextarea = styled.textarea`\r\n  width: 100%;\r\n  min-height: 120px;\r\n  padding: 12px;\r\n  border-radius: var(--radius-sm);\r\n  border: 1px solid var(--border);\r\n  background: var(--input-bg);\r\n  color: var(--text);\r\n  resize: vertical;\r\n  transition: var(--transition);\r\n  font-family: inherit;\r\n  font-size: 14px;\r\n  line-height: 1.5;\r\n\r\n  &:focus {\r\n    outline: none;\r\n    border-color: var(--primary);\r\n    box-shadow: 0 0 0 2px rgba(255, 69, 0, 0.2);\r\n  }\r\n`;\r\n\r\nconst SuggestionsList = styled.ul`\r\n  position: absolute;\r\n  bottom: 100%;\r\n  left: 0;\r\n  right: 0;\r\n  max-height: 200px;\r\n  overflow-y: auto;\r\n  background: var(--card-bg);\r\n  border: 1px solid var(--border);\r\n  border-radius: var(--radius-sm);\r\n  box-shadow: var(--shadow);\r\n  list-style: none;\r\n  padding: 0;\r\n  margin: 5px 0 0 0;\r\n  z-index: 100;\r\n`;\r\n\r\nconst SuggestionItem = styled.li`\r\n  padding: 8px 12px;\r\n  cursor: pointer;\r\n  display: flex;\r\n  align-items: center;\r\n  gap: 8px;\r\n  transition: var(--transition);\r\n\r\n  &:hover {\r\n    background: rgba(255, 69, 0, 0.1);\r\n  }\r\n`;\r\n\r\nconst Avatar = styled.img`\r\n  width: 24px;\r\n  height: 24px;\r\n  border-radius: 50%;\r\n  object-fit: cover;\r\n`;\r\n\r\nconst MentionInput = ({ value, onChange, placeholder }) => {\r\n  const [showSuggestions, setShowSuggestions] = useState(false);\r\n  const [suggestions, setSuggestions] = useState([]);\r\n  const [mentionQuery, setMentionQuery] = useState('');\r\n  const [mentionStartPos, setMentionStartPos] = useState(0);\r\n  const textareaRef = useRef(null);\r\n\r\n  const handleInputChange = (e) => {\r\n    const text = e.target.value;\r\n    onChange(text);\r\n    \r\n    // Captura a posição atual do cursor\r\n    const cursorPos = e.target.selectionStart;\r\n    \r\n    // Encontra a posição do último @ antes do cursor\r\n    const lastAtPos = text.lastIndexOf('@', cursorPos - 1);\r\n    \r\n    if (lastAtPos >= 0 && (cursorPos - lastAtPos) > 1) {\r\n      const query = text.substring(lastAtPos + 1, cursorPos);\r\n      setMentionQuery(query);\r\n      setMentionStartPos(lastAtPos);\r\n      \r\n      if (query.length >= 1) {\r\n        fetchMentions(query);\r\n        setShowSuggestions(true);\r\n      } else {\r\n        setShowSuggestions(false);\r\n      }\r\n    } else {\r\n      setShowSuggestions(false);\r\n    }\r\n  };\r\n\r\n  const fetchMentions = async (query) => {\r\n    try {\r\n      const response = await api.get('/users/search', {\r\n        params: { q: query }\r\n      });\r\n      \r\n      if (response.data?.data) {\r\n        setSuggestions(response.data.data);\r\n      }\r\n    } catch (error) {\r\n      console.error('Error fetching mentions:', error);\r\n      setSuggestions([]);\r\n    }\r\n  };\r\n\r\n  const handleSelectMention = (username) => {\r\n    if (!textareaRef.current) return;\r\n    \r\n    const currentValue = value;\r\n    const before = currentValue.substring(0, mentionStartPos);\r\n    const after = currentValue.substring(mentionStartPos + mentionQuery.length + 1);\r\n    const newText = `${before}@${username} ${after}`;\r\n    \r\n    onChange(newText);\r\n    setShowSuggestions(false);\r\n    \r\n    // Foca no textarea e posiciona o cursor\r\n    setTimeout(() => {\r\n      if (textareaRef.current) {\r\n        textareaRef.current.focus();\r\n        const newCursorPos = mentionStartPos + username.length + 2;\r\n        textareaRef.current.setSelectionRange(newCursorPos, newCursorPos);\r\n      }\r\n    }, 0);\r\n  };\r\n\r\n  // Fechar sugestões ao clicar fora\r\n  useEffect(() => {\r\n    const handleClickOutside = (e) => {\r\n      if (textareaRef.current && !textareaRef.current.contains(e.target)) {\r\n        setShowSuggestions(false);\r\n      }\r\n    };\r\n\r\n    document.addEventListener('mousedown', handleClickOutside);\r\n    return () => document.removeEventListener('mousedown', handleClickOutside);\r\n  }, []);\r\n\r\n  return (\r\n    <InputContainer>\r\n      <StyledTextarea\r\n        ref={textareaRef}\r\n        value={value}\r\n        onChange={handleInputChange}\r\n        onSelect={handleInputChange} // Importante para capturar seleção\r\n        placeholder={placeholder}\r\n      />\r\n      \r\n      {showSuggestions && suggestions.length > 0 && (\r\n        <SuggestionsList>\r\n          {suggestions.map(user => (\r\n            <SuggestionItem \r\n              key={user._id}\r\n              onClick={() => handleSelectMention(user.username)}\r\n            >\r\n              <Avatar \r\n                src={user.profile?.avatar || 'https://i.pravatar.cc/150?img=3'}\r\n                alt={user.username}\r\n                crossOrigin=\"anonymous\"\r\n                onError={(e) => {\r\n                  e.target.src = 'https://i.pravatar.cc/150?img=3';\r\n                }}\r\n              />\r\n              <span>@{user.username}</span>\r\n            </SuggestionItem>\r\n          ))}\r\n        </SuggestionsList>\r\n      )}\r\n    </InputContainer>\r\n  );\r\n};\r\n\r\nexport default MentionInput;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}