{"ast":null,"code":"// src/services/socket.js\nimport{io}from'socket.io-client';const API_URL=process.env.REACT_APP_API_URL||'https://api.jokesteronline.org';let socket;/**\r\n * Inicializa a conexão do socket\r\n * @param {string} token - Token JWT do usuário\r\n * @returns {Socket} Instância do socket\r\n */export const initSocket=token=>{if(!socket){socket=io(API_URL,{auth:{token},transports:['websocket'],reconnection:true,reconnectionAttempts:5,reconnectionDelay:1000,withCredentials:true// Adicione esta linha para CORS\n});socket.on('connect',()=>{console.log('Socket conectado:',socket.id);});socket.on('disconnect',reason=>{console.log('Socket desconectado. Razão:',reason);if(reason==='io server disconnect'){// Reconecta manualmente se o servidor desconectar\nsocket.connect();}});socket.on('connect_error',err=>{console.error('Erro de conexão:',err.message);console.error('Detalhes do erro:',err);// Tenta reconectar após um delay\nsetTimeout(()=>{socket.connect();},1000);});}return socket;};/**\r\n * Obtém a instância atual do socket\r\n * @returns {Socket|null} Instância do socket ou null\r\n */export const getSocket=()=>socket;/**\r\n * Configura um listener para notificações\r\n * @param {function} callback - Função a ser chamada quando uma notificação chegar\r\n */export const setupNotificationListener=callback=>{if(socket){socket.on('new-notification',callback);}else{console.warn('Socket não inicializado');}};/**\r\n * Remove todos os listeners de notificação\r\n */export const removeNotificationListeners=()=>{if(socket){socket.off('new-notification');}};/**\r\n * Desconecta o socket\r\n */export const disconnectSocket=()=>{if(socket){socket.disconnect();socket=null;}};","map":{"version":3,"names":["io","API_URL","process","env","REACT_APP_API_URL","socket","initSocket","token","auth","transports","reconnection","reconnectionAttempts","reconnectionDelay","withCredentials","on","console","log","id","reason","connect","err","error","message","setTimeout","getSocket","setupNotificationListener","callback","warn","removeNotificationListeners","off","disconnectSocket","disconnect"],"sources":["C:/Users/drrod/OneDrive/Área de Trabalho/client2/src/services/socket.js"],"sourcesContent":["// src/services/socket.js\r\nimport { io } from 'socket.io-client';\r\n\r\nconst API_URL = process.env.REACT_APP_API_URL || 'https://api.jokesteronline.org';\r\nlet socket;\r\n\r\n/**\r\n * Inicializa a conexão do socket\r\n * @param {string} token - Token JWT do usuário\r\n * @returns {Socket} Instância do socket\r\n */\r\nexport const initSocket = (token) => {\r\n  if (!socket) {\r\n    socket = io(API_URL, {\r\n      auth: { token },\r\n      transports: ['websocket'],\r\n      reconnection: true,\r\n      reconnectionAttempts: 5,\r\n      reconnectionDelay: 1000,\r\n      withCredentials: true, // Adicione esta linha para CORS\r\n    });\r\n\r\n    socket.on('connect', () => {\r\n      console.log('Socket conectado:', socket.id);\r\n    });\r\n\r\n    socket.on('disconnect', (reason) => {\r\n      console.log('Socket desconectado. Razão:', reason);\r\n      if (reason === 'io server disconnect') {\r\n        // Reconecta manualmente se o servidor desconectar\r\n        socket.connect();\r\n      }\r\n    });\r\n\r\n    socket.on('connect_error', (err) => {\r\n      console.error('Erro de conexão:', err.message);\r\n      console.error('Detalhes do erro:', err);\r\n      \r\n      // Tenta reconectar após um delay\r\n      setTimeout(() => {\r\n        socket.connect();\r\n      }, 1000);\r\n    });\r\n  }\r\n  return socket;\r\n};\r\n\r\n/**\r\n * Obtém a instância atual do socket\r\n * @returns {Socket|null} Instância do socket ou null\r\n */\r\nexport const getSocket = () => socket;\r\n\r\n/**\r\n * Configura um listener para notificações\r\n * @param {function} callback - Função a ser chamada quando uma notificação chegar\r\n */\r\nexport const setupNotificationListener = (callback) => {\r\n  if (socket) {\r\n    socket.on('new-notification', callback);\r\n  } else {\r\n    console.warn('Socket não inicializado');\r\n  }\r\n};\r\n\r\n/**\r\n * Remove todos os listeners de notificação\r\n */\r\nexport const removeNotificationListeners = () => {\r\n  if (socket) {\r\n    socket.off('new-notification');\r\n  }\r\n};\r\n\r\n/**\r\n * Desconecta o socket\r\n */\r\nexport const disconnectSocket = () => {\r\n  if (socket) {\r\n    socket.disconnect();\r\n    socket = null;\r\n  }\r\n};"],"mappings":"AAAA;AACA,OAASA,EAAE,KAAQ,kBAAkB,CAErC,KAAM,CAAAC,OAAO,CAAGC,OAAO,CAACC,GAAG,CAACC,iBAAiB,EAAI,gCAAgC,CACjF,GAAI,CAAAC,MAAM,CAEV;AACA;AACA;AACA;AACA,GACA,MAAO,MAAM,CAAAC,UAAU,CAAIC,KAAK,EAAK,CACnC,GAAI,CAACF,MAAM,CAAE,CACXA,MAAM,CAAGL,EAAE,CAACC,OAAO,CAAE,CACnBO,IAAI,CAAE,CAAED,KAAM,CAAC,CACfE,UAAU,CAAE,CAAC,WAAW,CAAC,CACzBC,YAAY,CAAE,IAAI,CAClBC,oBAAoB,CAAE,CAAC,CACvBC,iBAAiB,CAAE,IAAI,CACvBC,eAAe,CAAE,IAAM;AACzB,CAAC,CAAC,CAEFR,MAAM,CAACS,EAAE,CAAC,SAAS,CAAE,IAAM,CACzBC,OAAO,CAACC,GAAG,CAAC,mBAAmB,CAAEX,MAAM,CAACY,EAAE,CAAC,CAC7C,CAAC,CAAC,CAEFZ,MAAM,CAACS,EAAE,CAAC,YAAY,CAAGI,MAAM,EAAK,CAClCH,OAAO,CAACC,GAAG,CAAC,6BAA6B,CAAEE,MAAM,CAAC,CAClD,GAAIA,MAAM,GAAK,sBAAsB,CAAE,CACrC;AACAb,MAAM,CAACc,OAAO,CAAC,CAAC,CAClB,CACF,CAAC,CAAC,CAEFd,MAAM,CAACS,EAAE,CAAC,eAAe,CAAGM,GAAG,EAAK,CAClCL,OAAO,CAACM,KAAK,CAAC,kBAAkB,CAAED,GAAG,CAACE,OAAO,CAAC,CAC9CP,OAAO,CAACM,KAAK,CAAC,mBAAmB,CAAED,GAAG,CAAC,CAEvC;AACAG,UAAU,CAAC,IAAM,CACflB,MAAM,CAACc,OAAO,CAAC,CAAC,CAClB,CAAC,CAAE,IAAI,CAAC,CACV,CAAC,CAAC,CACJ,CACA,MAAO,CAAAd,MAAM,CACf,CAAC,CAED;AACA;AACA;AACA,GACA,MAAO,MAAM,CAAAmB,SAAS,CAAGA,CAAA,GAAMnB,MAAM,CAErC;AACA;AACA;AACA,GACA,MAAO,MAAM,CAAAoB,yBAAyB,CAAIC,QAAQ,EAAK,CACrD,GAAIrB,MAAM,CAAE,CACVA,MAAM,CAACS,EAAE,CAAC,kBAAkB,CAAEY,QAAQ,CAAC,CACzC,CAAC,IAAM,CACLX,OAAO,CAACY,IAAI,CAAC,yBAAyB,CAAC,CACzC,CACF,CAAC,CAED;AACA;AACA,GACA,MAAO,MAAM,CAAAC,2BAA2B,CAAGA,CAAA,GAAM,CAC/C,GAAIvB,MAAM,CAAE,CACVA,MAAM,CAACwB,GAAG,CAAC,kBAAkB,CAAC,CAChC,CACF,CAAC,CAED;AACA;AACA,GACA,MAAO,MAAM,CAAAC,gBAAgB,CAAGA,CAAA,GAAM,CACpC,GAAIzB,MAAM,CAAE,CACVA,MAAM,CAAC0B,UAAU,CAAC,CAAC,CACnB1B,MAAM,CAAG,IAAI,CACf,CACF,CAAC","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}